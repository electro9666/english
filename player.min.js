function includeJs(b){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.body.appendChild(a)}var youtubeapi="resources/iframe_api.js";$(document).ready(function(){Handlebars.registerHelper("calc",function(f){if(f!=null&&f!=""){f=f.replace(/\s/g,"_")}return f});var a=[{seq:1,list:["look who's here","a small world","how have you been","changed a bit","say hello to","catch you later","keep in touch"]},{seq:2,list:["you shouldn't have","give you a ride","don't bother","what friends are for","something smells fishy","just be yourself"]},{seq:3,list:["what's the weather","I get the feeling","call off","slipped my mind","don't tell me","behind my back","go with the flow"]},{seq:4,list:["I feel like going","previous engagement","nothing beats","come to think of it","you might as well","postpone it"]},{seq:5,list:["I pulled some strings","go easy on it","It's not gonna kill you","don't forget to"]},{seq:6,list:["where were we","look on the bright side","keep me posted"]},{seq:7,list:["make a reservation","it makes no difference","what do you mean","first come first served"]},{seq:8,list:["give me a hand","make excuses","take it out on me","all you have to do is"]},{seq:9,list:["want to come along","looking forward to","wouldn't miss it"]},{seq:10,list:["get along with","spit it out","getting out of hand","in a bad mood"]}];var h=$("#player_template2").html();var e=Handlebars.compile(h);var d=e(a);$("#leftSide").append(d);var b=location.search;if(b!=null&&b!=""){b=decodeURIComponent(b);var c=b.indexOf("?f=");if(c!=-1){var g=b.substring(c+3);includeJs("db/"+g+".js");$("#mainContents").show();$("#mainContents2").hide();$("#leftSide li a").each(function(f,j){if($(this).html()==g){$(this).css("text-decoration","underline");$(this).addClass("active")}})}}else{$("#mainContents").hide();$("#mainContents2").show()}});var isLoop=true;var isRepeat=true;var repeatMax=1;var repeatCount=0;var pList=[];var CPN=0;var CVS=0;var speed=1;var startMargin=0;var endMargin=0;var tempInterval;var tempInterval2;var tempInterval3;var retryCount=0;function clickVideo(a){}function setPlayerPause(b,a){}function endPlayer(){pList[now(CPN)].store.block=true;pList[now(CPN)].store.cvs=nextNextCVS();pList[now(CPN)].player.setVolume(0);pList[now(CPN)].player.loadVideoById(list[nextNextCVS()].videoId,getStartTime(nextNextCVS()));console.warn(CPN+"-->"+other(CPN));CPN=other(CPN);setPlaying()}function setPlaying(){setCVS(pList[now(CPN)].store.cvs);console.warn("CPN:"+CPN+", CVS:"+getCVS()+", nextCVS:"+nextCVS()+", nextNextCVS:"+nextNextCVS());isRepeat=true;$("#isRepeat").prop("checked",true);$("#parentIframe"+CPN).css("z-index","10");$("#parentIframe"+other(CPN)).css("z-index","1");$(".videoClass").css("background-color","white");$("#video"+getCVS()).css("background-color","orange");$("#startTime").val(getStartTime(getCVS()));$("#endTime").val(getEndTime());$("#startTimeFormat").html(formatTime(getStartTime(getCVS())));$("#endTimeFormat").html(formatTime(getEndTime()));$("#title").html("["+CVS+"] <span style='height:25px;font-size:20px;overflow-y:hidden;'>video loading...</span>");if(pList[now(CPN)].store.playReady){resetRetryCount();clearInterval(tempInterval2);pList[now(CPN)].store.playReady=false;pList[now(CPN)].store.block=false;pList[now(CPN)].player.playVideo();clearInterval(tempInterval3);tempInterval3=setInterval(function(){if(++retryCount>5){resetRetryCount();clearInterval(tempInterval3);endPlayer()}if(pList[now(CPN)].store.state==YT.PlayerState.PLAYING){resetRetryCount();clearInterval(tempInterval3)}else{console.log("계속 시도");showRetryCount();pList[now(CPN)].player.playVideo()}},500)}else{resetRetryCount();clearInterval(tempInterval2);tempInterval2=setInterval(function(){console.log("retryCount:"+retryCount);if(++retryCount>5){resetRetryCount();clearInterval(tempInterval2);endPlayer()}if(pList[now(CPN)].store.playReady){resetRetryCount();clearInterval(tempInterval2);pList[now(CPN)].store.playReady=false;pList[now(CPN)].store.block=false;pList[now(CPN)].player.playVideo();clearInterval(tempInterval3);tempInterval3=setInterval(function(){if(++retryCount>5){resetRetryCount();clearInterval(tempInterval3);endPlayer()}if(pList[now(CPN)].store.state==YT.PlayerState.PLAYING){resetRetryCount();clearInterval(tempInterval3)}else{console.log("계속 시도");showRetryCount();pList[now(CPN)].player.playVideo()}},500)}else{console.log("계속 시도");showRetryCount();pList[now(CPN)].store.block=true;pList[now(CPN)].player.playVideo()}},500)}}function firstStartPlayer(){resetRetryCount();if(pList[0].store.initReady&&pList[1].store.initReady){if(pList[0].state==YT.PlayerState.PLAYING){pList[0].player.pauseVideo()}if(pList[1].state==YT.PlayerState.PLAYING){pList[1].player.pauseVideo()}firstStartPlayerDetail()}else{clearInterval(tempInterval);tempInterval=setInterval(function(){retryCount++;if(pList[0].store.initReady&&pList[1].store.initReady){firstStartPlayerDetail()}else{showRetryCount()}},1000)}}function firstStartPlayerDetail(){resetRetryCount();clearInterval(tempInterval);console.log("all ready");pList[now(CPN)].store.block=true;pList[now(CPN)].store.cvs=getCVS();pList[now(CPN)].player.loadVideoById(list[getCVS()].videoId,getStartTime(getCVS()));pList[other(CPN)].store.block=true;pList[other(CPN)].store.cvs=nextCVS();pList[other(CPN)].player.setVolume(0);console.log("getStartTime(nextCVS()) : "+getStartTime(nextCVS()));pList[other(CPN)].player.loadVideoById(list[nextCVS()].videoId,getStartTime(nextCVS()));setPlaying()}function resetRetryCount(){console.log("resetRetryCount");retryCount=0;$("#retry").hide()}function showRetryCount(){$("#retry").show();$("#retry").html("retry: "+retryCount)}function now(a){return a}function other(a){return Number(!(a==true))}function setCVS(a){if(a<0){a=list.length-1}else{if(a>=list.length){a=0}}CVS=a}function getCVS(){return CVS}function nextCVS(){if(CVS>=list.length-1){return 0}else{return CVS+1}}function nextNextCVS(){if(list.length==1){return 0}else{if(CVS>=list.length-2){return CVS-(list.length-2)}else{return CVS+2}}}function getStartTime(b){if(isRepeat){var a=list[b].startTime+startMargin;if(a<0){return 0}return a}else{return 0}}function getEndTime(){if(list[getCVS()].endTime==0){var a=parseInt(Number(pList[CPN].player.getDuration()),10);console.log();if(a-getStartTime(getCVS())>10){a=getStartTime(getCVS())+10}list[getCVS()].endTime=a}return list[getCVS()].endTime+endMargin}var makePlayer=function(f,i){var l={};l.num=f;l.state=9999;l.initReady=false;l.playReady=false;var j;var m=new YT.Player(i,{width:550,height:500,videoId:"",playerVars:{playlist:"",controls:1,cc_load_policy:0},events:{onReady:k,onPlaybackQualityChange:h,onStateChange:c,onError:e}});function n(o,p){l.seq=o;l.videoId=p}function h(){}function e(o){console.warn("error: "+o.data)}function k(){console.log(f+" initReady");l.initReady=true}function c(o){l.state=o.data;var p="undefiend";switch(o.data){case YT.PlayerState.UNSTARTED:p="unstarted";updateRepeatCount(0);clearInterval(j);break;case YT.PlayerState.ENDED:p="ended";updateRepeatCount(0);clearInterval(j);a();break;case YT.PlayerState.PLAYING:p="playing";if(l.block){m.pauseVideo();return}if(getEndTime){$("#title").html("["+CVS+"] <span style='height:25px;font-size:20px;overflow-y:hidden;'>"+pList[now(CPN)].player.getVideoData().title+"</span>")}$("#sentence").html(list[getCVS()].sentence);m.setPlaybackRate(speed);clearInterval(j);j=setInterval(function(){g()},500);break;case YT.PlayerState.PAUSED:p="paused";clearInterval(j);if(l.block){m.setVolume(100);l.playReady=true}break;case YT.PlayerState.BUFFERING:p="buffering";clearInterval(j);break;case YT.PlayerState.CUED:p="video cued";updateRepeatCount(0);clearInterval(j);break;default:p="unknown ("+o.data+")"}}function g(){$("#currentTimeFormat").html(formatTime(m.getCurrentTime())+" (<font style='font-size:20px;color:red;'>"+parseInt(m.getCurrentTime()-getEndTime(),10)+"</font>)");if(isRepeat){if(m.getCurrentTime()<getStartTime(getCVS())){console.log(f+" player.getCurrentTime() < list[CVS].startTime");m.seekTo(getStartTime(getCVS()))}if(m.getCurrentTime()>getEndTime()){console.log(f+" player.getCurrentTime() > list[CVS].endTime");a()}}else{if(l.state==YT.PlayerState.ENDED){a()}}}function a(){updateRepeatCount(++repeatCount);if(isLoop&&repeatCount>=repeatMax){updateRepeatCount(0);m.pauseVideo();endPlayer()}else{m.seekTo(getStartTime(getCVS()))}}function d(){}function b(){}return{player:m,store:l}};function init1(){var d=$("#player_template").html();var c=Handlebars.compile(d);console.log("list.length:"+list.length);list.sort(function(){return 0.5-Math.random()});for(var b=0;b<list.length;b++){list[b].seq=b;var a=c(list[b]);$("#mainDiv").append(a);$(".videoClass[seq="+b+"]").attr("img",list[b].img);$(".videoClass[seq="+b+"] img").attr("src",list[b].img)}pList[0]=makePlayer(0,"youtubeIframe0");pList[1]=makePlayer(1,"youtubeIframe1");startMargin=Number($("#startMargin").val());endMargin=Number($("#endMargin").val());firstStartPlayer()}function onYouTubeIframeAPIReady(){if(typeof q=="undefined"||typeof list=="undefined"){$("#mainContents").hide();$("#mainContents2").show();alert("데이터가 존재하지 않습니다. 다시 시도해주세요.");return}$("#headerSentenceId").html(q+" ("+list.length+")");var a=$("#leftSide li a.active");a.html(a.html()+" ("+list.length+")");init1()}function repeatMaxUpdate(a){repeatMax=Number($("#repeatMax").val())}function makeLoop(a){isLoop=true;updateRepeatCount(0);repeatMax=Number($("#repeatMax").val());$("#btn0").addClass("btn-primary");$("#btn0").removeClass("btn-default");$("#btn1").removeClass("btn-primary");$("#btn1").addClass("btn-default");$("#repeatMax").removeAttr("disabled")}function makeLoop1(a){isLoop=false;updateRepeatCount(0);$("#btn0").removeClass("btn-primary");$("#btn0").addClass("btn-default");$("#btn1").addClass("btn-primary");$("#btn1").removeClass("btn-default");$("#repeatMax").attr("disabled","disabled")}function updateRepeatCount(a){repeatCount=a;if(isLoop){$("#repeatCount").html("("+(repeatCount+1)+"/"+repeatMax+"회 반복 중)")}else{$("#repeatCount").html("("+(repeatCount+1)+"회 반복 중)")}}function timeChange(b,c){var a;if(b=="start"){a=Number($("#startTime").val())+c;if(a<0){a=0}}else{if(b=="end"){a=Number($("#endTime").val())+c}}timeUpdate(b,a)}function timeChange2(a,b){timeUpdate(a,Number($(b).val()))}function timeUpdate(b,a){if(b=="start"){list[getCVS()].startTime=a;$("#mainControl #startTime").val(a);$("#mainControl #startTimeFormat").html(formatTime(a));pList[now(CPN)].player.seekTo(getStartTime(getCVS()))}else{if(b=="end"){list[getCVS()].endTime=a;$("#mainControl #endTime").val(a);$("#mainControl #endTimeFormat").html(formatTime(a))}}}function clickVideo(a){setCVS(Number($(a).attr("seq")));firstStartPlayer()}function formatTime(b){b=Math.round(b);var a=Math.floor(b/60);var c=b-a*60;c=c<10?"0"+c:c;return a+":"+c}function goPrev(a){setCVS(getCVS()+a);firstStartPlayer()}function speedUpdate(a){console.log();speed=Number($(a).val());pList[now(CPN)].player.setPlaybackRate(speed)}function marginUpdate(b,c){var a=Number($(c).val());if(b=="start"){startMargin=a}else{if(b=="end"){endMargin=a}}if(b=="start"){$("#mainControl #startTime").val(getStartTime(getCVS()));$("#mainControl #startTimeFormat").html(formatTime(getStartTime(getCVS())));pList[now(CPN)].player.seekTo(getStartTime(getCVS()))}else{if(b=="end"){$("#mainControl #endTime").val(getEndTime());$("#mainControl #endTimeFormat").html(formatTime(getEndTime()))}}}function repeatFlagUpdate(a){if(a.checked){isRepeat=true}else{isRepeat=false}};